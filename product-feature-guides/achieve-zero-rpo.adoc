---
permalink: product-feature-guides/achieve-zero-rpo.html 
sidebar: sidebar 
keywords: rpo, zero, rto, on-premises, storagegrid, object, replication, synchronous 
summary: 本技術報告概述 StorageGRID 複寫策略的實作，以在站台發生故障時達成 0 的恢復點目標（ RPO ）。 
---
= 使用 StorageGRID 實現零 RPO ：完整的多站台複寫指南
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
本技術報告全面指導如何實施StorageGRID複製策略，以在站點發生故障時實現復原點目標 (RPO) 為零。該文件詳細介紹了StorageGRID的各種部署選項，包括多站點同步複製和多網格非同步複製。它解釋如何設定StorageGRID資訊生命週期管理 (ILM) 策略，以確保跨多個位置的資料持久性和可用性。此外，該報告還涵蓋了效能考量、故障場景和恢復流程，以維持不間斷的客戶營運。本文檔的目標是提供相關信息，以確保即使在站點完全發生故障的情況下，數據仍然可訪問且一致，方法是利用同步和異步複製技術。



== StorageGRID 總覽

NetApp StorageGRID 是物件型儲存系統，支援業界標準的 Amazon Simple Storage Service （ Amazon S3 ） API 。

StorageGRID 在多個位置提供單一命名空間，並根據資訊生命週期管理原則（ ILM ）提供不同的服務層級。透過這些生命週期策略，您可以優化資料在整個生命週期中的儲存位置。

StorageGRID 提供可設定的耐用度，以及您在本機和地理區域分散式解決方案中資料的可用度。無論您的資料是在本地還是在公有雲中，整合的混合雲工作流程都允許您的企業利用雲端服務，例如 Amazon Simple Notification Service (Amazon SNS)、Google Cloud、Microsoft Azure Blob、Amazon S3 Glacier、Elasticsearch 等。



=== StorageGRID 擴充

最小的StorageGRID部署包括一個管理節點和 3 個儲存節點，位於同一個站點內。單一網格最多可以發展到 220 個節點。StorageGRID可以部署為單一站點，也可以擴展到 16 個站點。

管理節點包含管理介面、指標和日誌記錄的中心點，並維護StorageGRID元件的配置。管理節點還包含用於 S3 API 存取的整合負載平衡器。

StorageGRID可部署為純軟體、VMware 虛擬機器設備或專用設備。

儲存節點可以部署為：

* 僅元資料節點最大化物件數量
* 僅儲存物件的節點，最大化物件空間
* 組合元資料和物件儲存節點，新增物件計數和物件空間


每個儲存節點都可以擴展到多 PB 容量，用於物件存儲，從而允許單一命名空間擁有數百 PB 的容量。  StorageGRID也為 S3 API 操作提供了一個稱為網關節點的整合式負載平衡器。

image:zero-rpo/delivery-paths.png["StorageGRID 部署選項"]

StorageGRID由放置在站點拓撲中的節點集合組成。  StorageGRID中的站點可以是唯一的實體位置，也可以作為邏輯結構與網格中的其他站點位於共用的實體位置。 StorageGRID站點不應跨越多個實體位置。站點代表共用的區域網路 (LAN) 基礎架構和故障域。



=== StorageGRID 和故障網域

StorageGRID 包含多層故障網域，可用於決定如何建構解決方案，如何儲存資料，以及應將資料儲存在何處，以降低故障風險。

* 網格層級：由多個站台組成的網格可能會發生站台故障或隔離，而可存取的站台可以繼續作為網格運作。
* 站台層級：站台內的故障可能會影響該站台的作業，但不會影響網格的其餘部分。
* 節點層級：節點故障不會影響站台的運作。
* 磁碟層級：磁碟故障不會影響節點的運作。




=== 物件資料和中繼資料

使用物件儲存時、儲存單元是物件、而非檔案或區塊。不同於檔案系統或區塊儲存設備的樹狀階層、物件儲存設備會以無結構化的平面配置來組織資料。物件儲存設備可將資料的實體位置與用來儲存及擷取該資料的方法分離。

物件型儲存系統中的每個物件都有兩個部分：物件資料和物件中繼資料。

* 物件數據代表實際的基礎數據，例如照片、影片或醫療記錄。
* 物件中繼資料是指描述物件的任何資訊。


利用物件中繼資料來追蹤整個網格中所有物件的位置、並長期管理每個物件的生命週期。StorageGRID

物件中繼資料包含下列資訊：

* 系統元數據，包括每個物件的唯一 ID、物件名稱、S3 儲存桶的名稱、租用戶帳戶名稱或 ID、物件的邏輯大小、物件首次建立的日期和時間以及物件最後修改的日期和時間。
* 每個物件的副本或糾刪碼片段的目前儲存位置。
* 任何與物件相關聯的自訂使用者中繼資料金鑰值配對。
* 對於 S3 物件，任何與物件相關的物件標籤金鑰值配對
* 對於分段對象和多部分對象，段標識符和資料大小。


物件中繼資料可自訂且可擴充、使應用程式更靈活地使用。如需 StorageGRID 儲存物件中繼資料的方式及位置的詳細資訊，請前往 https://docs.netapp.com/us-en/storagegrid/admin/managing-object-metadata-storage.html["管理物件中繼資料儲存"]。

StorageGRID 的資訊生命週期管理（ ILM ）系統用於協調 StorageGRID 系統中所有物件資料的放置，持續時間和擷取行為。ILM 規則決定 StorageGRID 如何使用物件的複本來儲存物件，或是在節點和站台之間對物件進行銷毀編碼。此 ILM 系統負責在網格內保持物件資料一致性。



=== 銷毀編碼

StorageGRID提供在節點層級和磁碟機層級擦除程式碼資料的能力。使用StorageGRID設備，我們對每個節點上儲存在該節點內所有磁碟機上的資料進行擦除編碼，從而提供本機保護，防止多個磁碟故障導致資料遺失或中斷。驅動器故障的重建在節點本地進行，不需要透過網路複製資料。

此外， StorageGRID設備使用擦除編碼方案將物件資料儲存在站點內的節點上，或分佈在StorageGRID系統中的 3 個或更多站點上，儘管 StorageGRID 的 ILM 規則可防止節點故障。

糾刪碼提供了一種儲存佈局，該佈局能夠抵禦節點和站點故障，並且開銷比複製更低。只要滿足儲存資料區塊所需的最小節點數，所有StorageGRID糾刪碼方案都可以在單一網站中部署。這意味著對於 4+2 的 EC 方案，至少需要 6 個節點來接收資料。

image:zero-rpo/ec-schemes.png["物件可用的 StorageGRID 抹除編碼配置"]



=== 中繼資料一致性

在 StorageGRID 中，中繼資料通常會每個站台儲存三個複本，以確保一致性和可用度。這種備援功能有助於維持資料完整性和存取能力，即使發生故障也沒問題。

預設一致性是在全網格層級定義。使用者可以隨時變更貯體層級的一致性。

StorageGRID 提供的貯體一致性選項包括：

* * 全部 * ：提供最高等級的一致性。網格中的所有節點都會立即接收資料，否則要求將會失敗。
* *強全球化*：
+
** *Legacy Strong Global*：確保所有網站上所有用戶端要求的讀寫一致性。
+
*** 對於所有從 11.9 或更早版本升級到 12.0 且未手動更改為新的 Quorum Strong Global 的系統，這是預設行為。


** *Quorum Strong-global*：保證所有網站上所有客戶端請求的讀寫一致性。如果可以實現元資料副本仲裁，則可以為多個節點甚至站點故障提供一致性。
+
*** 這是所有新安裝的 12.0 或更高版本系統的預設行為。
*** QUORUM 一致性定義為儲存節點元資料副本的仲裁，其中每個站點有 3 個元資料副本。計算方法如下：1+((N*3)/2)，其中 N 為站點總數
*** 例如，3 站點網格必須至少製作 5 個副本，每個站點最多可製作 3 個副本。




* *Strong-site* ：保證網站內所有用戶端要求的寫入後讀取一致性。
* * 新寫入後讀取 * （預設）：提供新物件的寫入後讀取一致性，以及物件更新的最終一致性。提供高可用度與資料保護保證。建議大多數情況下使用。
* * 可用 * ：提供新物件和物件更新的最終一致性。對於 S3 貯體、請僅視需要使用（例如、包含很少讀取的記錄值之貯體、或用於對不存在的金鑰執行 head 或 Get 作業）。S3 FabricPool 儲存區不支援。




=== 物件資料一致性

雖然中繼資料會在站台內及站台之間自動複寫，但物件資料儲存位置的決策取決於您。物件資料可以儲存在站台內和跨站台的複本中，在站台內或跨站台進行銷毀編碼，或是組合或複本，以及銷毀編碼儲存配置。ILM 規則可套用至所有物件，或僅篩選至特定物件，貯體或租戶。ILM 規則定義物件的儲存方式，複本和 / 或銷毀編碼，物件在這些位置儲存的時間，複本或銷毀編碼配置的數量應變更，或位置應隨著時間而變更。

每個 ILM 規則都會設定三種擷取行為之一來保護物件：雙重認可，平衡或嚴格。

雙重提交選項會立即在網格中的任兩個不同的儲存節點上建立兩個副本，並將請求成功傳回給客戶端。節點選擇將首先在請求站點內進行，但在某些情況下可能會使用其他站點的節點。該物件被添加到 ILM 隊列中，以便根據 ILM 規則進行評估和放置。

平衡選項會立即根據 ILM 策略評估對象，並在向客戶端返回請求成功之前同步放置對象。如果由於故障或儲存空間不足而無法立即滿足放置要求，則將改用雙重提交。問題解決後，ILM 將根據定義的規則自動放置物件。

嚴格選項會立即根據 ILM 策略評估對象，並在向客戶端返回請求成功之前同步放置對象。如果由於中斷或儲存空間不足而無法立即滿足 ILM 規則，則請求將失敗，用戶端需要重試。



=== 負載平衡

StorageGRID 可透過整合式閘道節點，外部 3^rd^ 協力廠商負載平衡器， DNS 循環配置資源，或直接部署至儲存節點，以進行用戶端存取。您可以在站台中部署多個閘道節點，並在高可用度群組中進行設定，以在閘道節點中斷時提供自動容錯移轉和容錯回復。您可以在解決方案中結合負載平衡方法，為解決方案中的所有站台提供單一存取點。

預設情況下，網關節點將平衡其所在站點內各個儲存節點之間的負載。StorageGRID可以設定為允許網關節點使用來自多個站點的節點來平衡負載。這種配置會將這些站點之間的延遲添加到客戶端請求的回應延遲中。只有當客戶可以接受總延遲時，才應進行此配置。

透過本地和全域負載平衡相結合，可以確保 RTO 為零。確保客戶端不間斷存取需要對客戶端請求進行負載平衡。StorageGRID解決方案可在每個站點包含多個網關節點和高可用性群組。為了確保即使在站點發生故障的情況下，客戶端也能在任何站點獲得不間斷的訪問，您應該配置外部負載平衡解決方案，並將其與StorageGRID網關節點結合使用。設定網關高可用性群組，以管理每個站點內的負載，並使用外部負載平衡器在高可用性群組之間平衡負載。必須設定外部負載平衡器以執行健康檢查，以確保請求僅傳送到正在執行的網站。有關使用StorageGRID進行負載平衡的更多信息，請參閱 https://www.netapp.com/media/17068-tr4626.pdf["StorageGRID 負載平衡器技術報告"]。



== StorageGRID的零 RPO 要求

若要在物件儲存系統中實現零恢復點目標（ RPO ），在故障發生時必須：

* 中繼資料和物件內容都同步，而且被視為一致的
* 即使發生故障，物件內容仍可存取。


對於多站點部署，Quorum Strong Global 是首選的一致性模型，可確保元資料在所有站點之間同步，這對於滿足零 RPO 要求至關重要。

儲存系統中的物件是根據資訊生命週期管理 (ILM) 規則進行儲存的，這些規則規定了資料在其整個生命週期中如何以及在哪裡儲存。對於同步複製，可以考慮嚴格執行或平衡執行。

* 零 RPO 必須嚴格執行這些 ILM 規則，因為它能確保物件置於定義的位置，不會有任何延遲或後退，維持資料可用度和一致性。
* StorageGRID 的 ILM Balance 擷取行為可在高可用度與恢復能力之間取得平衡，讓使用者即使在站台發生故障時也能繼續擷取資料。




== 跨多個站台進行同步部署

*多站點解決方案：* StorageGRID可讓您在網格內的多個站點之間同步複製物件。透過設定具有平衡或嚴格行為的資訊生命週期管理 (ILM) 規則，物件會立即放置在指定位置。將儲存桶一致性等級配置為 Quorum Strong Global 也將確保同步元資料複製。 StorageGRID使用單一全域命名空間，將物件放置位置儲存為元數據，因此每個節點都知道所有副本或擦除編碼片段的位置。如果無法從發出請求的站點檢索對象，則將自動從遠端站點檢索該對象，而無需故障轉移程序。

一旦故障解決，就不需要手動進行容錯回復。複寫效能取決於網路處理量最低，延遲最高，效能最低的站台。站台效能是根據節點數量， CPU 核心數和速度，記憶體，磁碟機數量和磁碟機類型而定。

* 多網格解決方案： * StorageGRID 可以使用跨網格複寫（ CGR ），在多個 StorageGRID 系統之間複寫租戶，使用者和貯體。CGR 可將選取的資料延伸至超過 16 個站台，增加物件儲存區的可用容量，並提供災難恢復。使用 CGR 複寫貯體包括物件，物件版本和中繼資料，可以是雙向或單向的。恢復點目標（ RPO ）取決於每個 StorageGRID 系統的效能，以及它們之間的網路連線。

* 摘要： *

* 網格內複寫包括同步和非同步複寫，可透過 ILM 擷取行為和中繼資料一致性控制進行設定。
* 網格間複寫僅為非同步複寫。




== 單一網格多站台部署

在下列場景中， StorageGRID解決方案配置了一個可選的外部負載平衡器，用於管理整合負載平衡器高可用性群組的請求。這將實現零 RTO 和零 RPO。ILM 配置了平衡攝取保護，用於同步放置。每個儲存桶都配置了適用於 3 個或更多網站的網格的 Quorum 版本的強全域一致性模型，以及適用於 2 個網站的 Legacy 版本的強全域一致性模型。

*情境一：*

在雙站點StorageGRID解決方案中，每個物件至少有兩個副本，所有元資料至少有 6 個副本。故障復原後，中斷期間的更新將自動同步到已復原的網站/節點。只有 2 個站點，在站點完全遺失以外的故障情況下，不太可能實現零 RPO。

image:zero-rpo/2-site.png["雙站台 StorageGRID 系統"]

*情境二：*

在擁有三個或更多站點的StorageGRID解決方案中，每個物件至少有 3 個副本或 3 個 EC 區塊，所有元資料至少有 9 個副本。故障復原後，中斷期間的更新將自動同步到已復原的網站/節點。如果擁有三個或更多站點，則有可能實現零 RPO。

image:zero-rpo/3-site.png["三站台 StorageGRID 系統"]

多站台故障案例

[cols="34%,33%,33%"]
|===
| 故障 | 雙站點成果 + 傳承強大的全球 | 3 個或更多站點結果 + 法定人數強全球 


| 單節點磁碟機故障 | 每個應用裝置使用多個磁碟群組，每個群組至少可維持 1 個磁碟機故障，而不會中斷或遺失資料。 | 每個應用裝置使用多個磁碟群組，每個群組至少可維持 1 個磁碟機故障，而不會中斷或遺失資料。 


| 單一站台發生單一節點故障 | 不中斷營運或資料遺失。 | 不中斷營運或資料遺失。 


| 單一站台發生多個節點故障  a| 
中斷客戶端對此站點的操作，但不會丟失任何數據。

導向至另一個站台的作業會保持不中斷，且不會遺失資料。
| 作業會導向所有其他站台，並保持不中斷且不會遺失資料。 


| 在多個站台發生單一節點故障  a| 
在下列情況下不會中斷或遺失資料：

* 網格中至少存在一個副本。
* 網格中有足夠的 EC 區塊


若發生下列情況，作業中斷及資料遺失風險：

* 沒有副本
* EC Chucks 不足

 a| 
在下列情況下不會中斷或遺失資料：

* 網格中至少存在一個副本。
* 網格中有足夠的 EC 區塊


若發生下列情況，作業中斷及資料遺失風險：

* 沒有副本
* 沒有足夠的 EC Chucks 來擷取物件




| 單一站台故障 | 部分客戶端操作將會中斷，直到故障解決。GET 和 HEAD 操作將繼續進行，不會中斷。在此故障狀態下，將儲存桶一致性降低到新寫入後讀取或更低，以繼續不間斷地執行操作。 | 不中斷營運或資料遺失。 


| 單一站台加上單一節點故障 | 部分客戶端操作將會中斷，直到故障解決為止。HEAD 的運作將持續進行，不會中斷。如果存在副本或足夠的 EC 資料塊，GET 操作將繼續進行，不會中斷。在此故障狀態下，將儲存桶一致性降低到新寫入後讀取或更低，以繼續不間斷地執行操作。 | 營運未中斷，資料未遺失。根據副本數量，可能出現資料遺失。局部糾刪碼可以防止資料遺失。 


| 單一站台加上每個剩餘站台的節點 | 只有兩個網站。請參閱：單站點加單節點。 | 如果元資料副本法定人數無法滿足要求，則營運將會中斷。在此故障狀態下，將儲存桶一致性降低到新寫入後讀取或更低，以繼續不間斷地執行操作。根據副本數量，永久性故障可能導致資料遺失。局部糾刪碼可以防止資料遺失。 


| 多站台故障 | 所有營運場所均已關閉。如果至少一個站點無法完全恢復，則資料將會遺失。 | 如果元資料副本法定人數無法滿足要求，則營運將會中斷。在此故障狀態下，將儲存桶一致性降低到新寫入後讀取或更低，以繼續不間斷地執行操作。如果剩餘的糾刪碼區塊不足，則可能導致永久性故障，造成資料遺失。本機糾刪碼或資料複製可以防止資料遺失。 


| 站台的網路隔離 | 客戶端操作將中斷，直到故障解決為止。在此故障狀態下，將儲存桶一致性降低到新寫入後讀取或更低，以繼續不間斷地執行操作。無資料遺失 | 該孤立站點的運作將受到影響，但不會出現資料遺失。在此故障狀態下，將儲存桶一致性降低到新寫入後讀取或更低，以繼續不間斷地執行操作。其餘站點的營運未受影響，數據也未遺失。 
|===


== 多站台多網格部署

為了新增額外的冗餘層，此場景將採用兩個StorageGRID叢集並使用跨網格複製來保持它們同步。對於此解決方案，每個StorageGRID叢集將有三個站點。兩個站點將用於物件儲存和元數據，而第三個站點將僅用於元數據。兩個系統都將配置平衡的 ILM 規則，以使用擦除編碼在兩個資料站點中同步儲存物件。儲存桶將採用 Quorum Strong Global 一致性模型進行設定。每個網格將在每個儲存桶上配置雙向跨網格複製。這提供了區域之間的非同步複製。可以選擇實作全域負載平衡器來管理兩個StorageGRID系統的整合負載平衡器高可用性群組的請求，以實現零 RPO。

此解決方案將使用四個位置，分為兩個區域。區域 1 將包含網格 1 的 2 個儲存網站，做為區域的主要網格，以及網格 2 的中繼資料網站。區域 2 將包含網格 2 的 2 個儲存網站，做為區域的主要網格，以及網格 1 的中繼資料網站。在每個區域中，相同的位置可以容納該區域主要網格的儲存網站，以及其他區域網格的中繼資料唯一網站。只使用中繼資料節點做為第三個站台，可提供中繼資料所需的一致性，而不會複製該位置中物件的儲存。

image:zero-rpo/2x-grid-3-site.png["四站台多網格解決方案"]

此解決方案具有四個獨立位置，可提供兩個獨立 StorageGRID 系統的完整備援，維護 0 的 RPO ，並同時使用多站台同步複寫和多網格非同步複寫。任何單一站台都可能發生故障，同時在兩個 StorageGRID 系統上維持不中斷的用戶端作業。

在本解決方案中，每個物件有四個銷毀編碼複本，所有中繼資料有 18 個複本。如此一來，就能在不影響用戶端作業的情況下執行多種故障案例。當故障恢復時，系統會自動將故障的站台 / 節點同步更新。

多站台，多網格故障案例

[cols="50%,50%"]
|===
| 故障 | 結果 


| 單節點磁碟機故障 | 每個應用裝置使用多個磁碟群組，每個群組至少可維持 1 個磁碟機故障，而不會中斷或遺失資料。 


| 網格中的一個站台發生單一節點故障 | 不中斷營運或資料遺失。 


| 每個網格中的一個站台發生單一節點故障 | 不中斷營運或資料遺失。 


| 網格中的一個站台發生多個節點故障 | 不中斷營運或資料遺失。 


| 每個網格中的一個站台發生多個節點故障 | 不中斷營運或資料遺失。 


| 在網格中的多個站台發生單一節點故障 | 不中斷營運或資料遺失。 


| 每個網格中的多個站台發生單一節點故障 | 不中斷營運或資料遺失。 


|  |  


| 網格中的單一站台故障 | 不中斷營運或資料遺失。 


| 每個網格中都有單一站台故障 | 不中斷營運或資料遺失。 


| 網格中的單一站台加上單一節點故障 | 不中斷營運或資料遺失。 


| 單一站台加上單一網格中每個剩餘站台的節點 | 不中斷營運或資料遺失。 


|  |  


| 單一位置故障 | 不中斷營運或資料遺失。 


| 每個網格 DC1 和 DC3 中的單一位置故障  a| 
作業將中斷，直到故障解決或鏟斗一致性降低為止；每個網格遺失 2 個站台

所有資料仍存在於 2 個位置



| 每個網格 DC1 和 DC4 或 DC2 和 DC3 中的單一位置故障 | 不中斷營運或資料遺失。 


| 每個網格 DC2 和 DC4 中的單一位置故障 | 不中斷營運或資料遺失。 


|  |  


| 站台的網路隔離  a| 
隔離站台的作業將會中斷，但不會遺失任何資料

不會中斷其餘站台的營運，也不會遺失資料。

|===


== 結論

使用 StorageGRID 達成零恢復點目標（ RPO ）是確保資料在站台發生故障時的持久性和可用度的關鍵目標。透過運用 StorageGRID 強大的複寫策略，包括多站台同步複寫和多網格非同步複寫，組織可以維持不中斷的用戶端作業，並確保多個位置的資料一致性。資訊生命週期管理（ ILM ）原則的實作以及僅中繼資料節點的使用，進一步增強了系統的恢復能力和效能。有了 StorageGRID ，企業就能安心管理資料，因為即使面對複雜的故障情況，資料仍可存取且一致。這種資料管理與複寫的全方位方法，突顯了精密規劃與執行的重要性，使零 RPO 達到零，並保護寶貴資訊。
